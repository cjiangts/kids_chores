<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kid Chinese Writing Profile - Kids Daily Chores</title>
    <link rel="stylesheet" href="fonts-local.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .settings-section,
        .add-card-section,
        .sheet-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1.2rem;
        }

        .sheet-row {
            display: flex;
            gap: 1rem;
            align-items: end;
            flex-wrap: wrap;
        }

        .sheet-row .form-group {
            margin-bottom: 0;
            max-width: 220px;
        }

        .sheet-view-btn {
            background: #6c757d;
        }

        .sheet-view-btn:hover {
            background: #5a6268;
        }

        .submit-btn {
            background: #28a745;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
        }

        .submit-btn:hover {
            background: #218838;
        }

        .preset-btn {
            margin-top: 0.6rem;
            width: 100%;
            background: #2d7ef7;
            color: white;
            padding: 0.7rem 1.1rem;
            border: none;
            border-radius: 4px;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .preset-btn:hover {
            background: #1f6ce0;
        }

        .bulk-import-wrap {
            margin-top: 0.4rem;
        }

        .bulk-import-wrap textarea {
            width: 100%;
            min-height: 110px;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
            resize: vertical;
            box-sizing: border-box;
        }

        .cards-section h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .cards-subsection {
            margin-bottom: 1rem;
        }

        .cards-subsection h3 {
            margin-bottom: 0.7rem;
            color: #333;
            font-size: 1rem;
        }

        .cards-subsection .empty-line {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.6rem;
        }

        .card-item {
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        .card-item.selected-audio-target {
            border: 2px solid #2d7ef7;
            box-shadow: 0 0 0 3px rgba(45, 126, 247, 0.14);
        }

        .card-front {
            font-size: 4.5rem;
            color: #333;
            font-family: var(--font-kaiti);
            line-height: 1.15;
        }

        .card-actions {
            display: flex;
            gap: 0.6rem;
            justify-content: center;
            margin-top: 0.6rem;
        }

        .card-action-btn {
            border: none;
            border-radius: 6px;
            padding: 0.38rem 0.6rem;
            cursor: pointer;
            color: white;
            font-size: 0.82rem;
        }

        .play-btn {
            background: #2d7ef7;
        }

        .selected-audio-bar {
            margin-top: 0.55rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: #eef4ff;
            border: 1px solid #cfdcfb;
            text-align: left;
        }

        .selected-audio-title {
            font-size: 0.8rem;
            color: #24468f;
            font-weight: 700;
            margin-bottom: 0.35rem;
        }

        .selected-audio-actions {
            display: flex;
            gap: 0.35rem;
            flex-wrap: wrap;
        }

        .selected-audio-btn {
            border: none;
            border-radius: 6px;
            padding: 0.3rem 0.5rem;
            color: white;
            cursor: pointer;
            font-size: 0.78rem;
        }

        .selected-audio-btn.record {
            background: #2d7ef7;
        }

        .selected-audio-btn.stop {
            background: #dc3545;
        }

        .selected-audio-btn.save {
            background: #1f8e43;
        }

        .selected-audio-btn.clear {
            background: #6c757d;
        }

        .selected-audio-btn:disabled {
            opacity: 0.55;
            cursor: not-allowed;
        }

        .card-audio-player {
            width: 100%;
            margin-top: 0.35rem;
        }

    </style>
</head>
<body class="practice-page manage-page">
    <div class="container">
        <div class="header">
            <h1 id="kidName">Loading...</h1>
            <a href="/admin.html" class="back-btn">‚Üê Back</a>
        </div>

        <div class="tab-nav">
            <a id="charactersTab" class="tab-link secondary" href="#">üìñ Manage Chinese Reading</a>
            <a id="writingTab" class="tab-link primary" href="#">‚úçÔ∏è Manage Chinese Writing</a>
            <a id="mathTab" class="tab-link secondary" href="#">‚ûó Manage Math</a>
        </div>

        <div id="errorMessage" class="error hidden"></div>

        <div class="settings-section">
            <h2>Practice Settings</h2>
            <form id="sessionSettingsForm" class="settings-row">
                <div class="form-group">
                    <label for="sessionCardCount">Chinese Writing Cards Per Session</label>
                    <input type="number" id="sessionCardCount" min="0" max="200" step="1" required>
                </div>
                <button type="submit" class="settings-save-btn">Save</button>
            </form>
        </div>

        <div class="add-card-section">
            <h2 class="label-with-help">
                <span>Add New Chinese Writing Prompt</span>
                <details class="help-details">
                    <summary title="Batch import tip">i</summary>
                    <div class="help-bubble">
                        Bulk adding is supported here. You can paste a long text block (single chars, words, or sentences). The system splits by non-Chinese separators, keeps Chinese chunks as prompts, and automatically deduplicates prompts already in the bank.
                    </div>
                </details>
            </h2>
            <div class="bulk-import-wrap">
                <form id="bulkImportForm">
                    <div class="form-group">
                        <label for="bulkWritingText">Chinese words/phrases</label>
                        <textarea id="bulkWritingText" placeholder="ÊØîÂ¶ÇÔºö‰ªäÂ§©ÔºåÂ§©Ê∞îÂæàÂ•Ω„ÄÇÁà∏Áà∏Â¶àÂ¶àÂéªÂÖ¨Âõ≠„ÄÇ"></textarea>
                    </div>
                    <button type="submit" id="bulkAddBtn" class="submit-btn">Bulk Add Chinese Writing Prompt</button>
                    <button type="button" id="addMaLiPingWritingBtn" class="preset-btn">Add È©¨Á´ãÂπ≥</button>
                    <div id="bulkImportErrorMessage" class="error hidden" style="margin-top: 0.8rem;"></div>
                </form>
            </div>
        </div>

        <div class="sheet-section">
            <h2 class="label-with-help">
                <span>Generate Practice Sheet</span>
                <details class="help-details">
                    <summary title="Sheet generation tip">i</summary>
                    <div class="help-bubble">
                        Layout: each row has 10 Tianzige boxes. The first row for each card includes demo text; repeat rows focus on copying practice. Rows Per Card controls how many rows each card gets.
                        <br><br>
                        Card selection: we only pick cards that are not currently practicing on another sheet. Priority goes to cards the kid got wrong most recently (or never practiced yet), then fills from the normal pool.
                    </div>
                </details>
            </h2>
            <div class="sheet-row">
                <div class="form-group">
                    <label for="sheetCardCount">Cards Per Sheet</label>
                    <input type="number" id="sheetCardCount" min="1" max="200" step="1" value="10" required>
                </div>
                <div class="form-group">
                    <label for="sheetRowsPerChar">Rows Per Card</label>
                    <input type="number" id="sheetRowsPerChar" min="1" max="10" step="1" value="1" required>
                </div>
                <button type="button" id="createSheetBtn" class="settings-save-btn">Generate</button>
                <button type="button" id="viewSheetsBtn" class="settings-save-btn sheet-view-btn">Manage Sheets</button>
            </div>
            <div id="practicingSummary" style="margin-top: 0.65rem; padding: 0.6rem 0.75rem; border-radius: 8px; background: #fff7df; color: #6b5500; font-size: 0.9rem;">
                Currently practicing: none
            </div>
            <div id="sheetErrorMessage" class="error hidden" style="margin-top: 0.8rem;"></div>
        </div>

        <div class="cards-section">
            <h2 class="cards-title">Chinese Character Writing Cards <span id="cardCount">(0)</span></h2>
            <div class="cards-toolbar">
                <input
                    type="text"
                    id="cardSearchInput"
                    class="cards-search-input"
                    placeholder="Search cards..."
                    aria-label="Search Chinese writing cards"
                >
                <select id="viewOrderSelect" class="sort-select">
                    <option value="added_time" selected>Order: Added Time (Recent to Oldest)</option>
                    <option value="queue">Order: Next Session Queue</option>
                    <option value="hardness_desc">Order: Hardness Score (Desc)</option>
                </select>
            </div>
            <div id="cardsGrid" class="cards-grid"></div>
        </div>
    </div>

    <script src="practice-manage-common.js"></script>
    <script src="kid-writing-manage.js"></script>
</body>
</html>
