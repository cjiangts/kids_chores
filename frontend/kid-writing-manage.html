<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kid Chinese Writing Profile - Kids Daily Chores</title>
    <link rel="stylesheet" href="fonts-local.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .settings-section,
        .add-card-section,
        .sheet-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1.2rem;
        }

        .sheet-row {
            display: flex;
            gap: 1rem;
            align-items: end;
            flex-wrap: wrap;
        }

        .sheet-row .form-group {
            margin-bottom: 0;
            max-width: 220px;
        }

        .sheet-view-btn {
            background: #6c757d;
        }

        .sheet-view-btn:hover {
            background: #5a6268;
        }

        .submit-btn,
        .record-btn,
        .stop-btn {
            background: #007bff;
            color: white;
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .submit-btn:hover,
        .record-btn:hover,
        .stop-btn:hover {
            background: #0069d9;
        }

        .submit-btn {
            width: 100%;
            margin-top: 1rem;
            background: #28a745;
        }

        .submit-btn:hover {
            background: #218838;
        }

        .stop-btn {
            background: #dc3545;
        }

        .stop-btn:hover {
            background: #c82333;
        }

        .record-controls {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .record-status {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #666;
            min-height: 1.2rem;
        }

        .audio-player-wrap {
            width: 100%;
            max-width: 420px;
            margin-top: 0.6rem;
        }

        .audio-player {
            width: 100%;
        }

        .cards-section h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .cards-subsection {
            margin-bottom: 1rem;
        }

        .cards-subsection h3 {
            margin-bottom: 0.7rem;
            color: #333;
            font-size: 1rem;
        }

        .cards-subsection .empty-line {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.6rem;
        }

        .card-item {
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        .card-front {
            font-size: 4.5rem;
            color: #333;
            font-family: var(--font-kaiti);
            line-height: 1.15;
        }

        .card-actions {
            display: flex;
            gap: 0.6rem;
            justify-content: center;
            margin-top: 0.6rem;
        }

        .card-action-btn {
            border: none;
            border-radius: 6px;
            padding: 0.38rem 0.6rem;
            cursor: pointer;
            color: white;
            font-size: 0.82rem;
        }

        .play-btn {
            background: #2d7ef7;
        }

    </style>
</head>
<body class="practice-page manage-page">
    <div class="container">
        <div class="header">
            <h1 id="kidName">Loading...</h1>
            <a href="/admin.html" class="back-btn">‚Üê Back</a>
        </div>

        <div class="tab-nav">
            <a id="charactersTab" class="tab-link secondary" href="#">üìñ Manage Chinese Reading</a>
            <a id="writingTab" class="tab-link primary" href="#">‚úçÔ∏è Manage Chinese Writing</a>
            <a id="mathTab" class="tab-link secondary" href="#">‚ûó Manage Math</a>
        </div>

        <div id="errorMessage" class="error hidden"></div>

        <div class="settings-section">
            <h2>Practice Settings</h2>
            <form id="sessionSettingsForm" class="settings-row">
                <div class="form-group">
                    <label for="sessionCardCount">Chinese Writing Cards Per Session</label>
                    <input type="number" id="sessionCardCount" min="0" max="200" step="1" required>
                </div>
                <button type="submit" class="settings-save-btn">Save</button>
            </form>
        </div>

        <div class="add-card-section">
            <h2 class="label-with-help">
                <span>Add New Chinese Writing Prompt</span>
                <details class="help-details">
                    <summary title="Batch import tip">i</summary>
                    <div class="help-bubble">
                        You can enter a single Chinese character or a full phrase/word here. Unlike Chinese reading import, Chinese writing keeps the full text as-is and does not auto-remove non-Chinese parts.
                    </div>
                </details>
            </h2>
            <form id="addCardForm">
                <div class="form-group">
                    <label for="chineseChars">Chinese Character(s)</label>
                    <input type="text" id="chineseChars" class="chinese-input" placeholder="‰Ω†" required>
                </div>
                <div class="form-group">
                    <label>Record Parent Voice Prompt</label>
                    <div class="record-controls">
                        <button type="button" id="recordBtn" class="record-btn">Start Recording</button>
                    </div>
                    <p id="recordStatus" class="record-status">No recording yet</p>
                    <div class="audio-player-wrap">
                        <audio id="audioPlayer" class="audio-player" controls preload="metadata"></audio>
                    </div>
                </div>
                <button type="submit" class="submit-btn">Add Chinese Writing Card(s)</button>
                <div id="addCardErrorMessage" class="error hidden" style="margin-top: 0.8rem;"></div>
            </form>
        </div>

        <div class="sheet-section">
            <h2 class="label-with-help">
                <span>Generate Practice Sheet</span>
                <details class="help-details">
                    <summary title="Sheet generation tip">i</summary>
                    <div class="help-bubble">
                        Layout: each row has 10 Tianzige boxes. The first row for each card includes demo text; repeat rows focus on copying practice. Rows Per Card controls how many rows each card gets.
                        <br><br>
                        Card selection: we only pick cards that are not currently practicing on another sheet. Priority goes to cards the kid got wrong most recently (or never practiced yet), then fills from the normal pool.
                    </div>
                </details>
            </h2>
            <div class="sheet-row">
                <div class="form-group">
                    <label for="sheetCardCount">Cards Per Sheet</label>
                    <input type="number" id="sheetCardCount" min="1" max="200" step="1" value="10" required>
                </div>
                <div class="form-group">
                    <label for="sheetRowsPerChar">Rows Per Card</label>
                    <input type="number" id="sheetRowsPerChar" min="1" max="10" step="1" value="1" required>
                </div>
                <button type="button" id="createSheetBtn" class="settings-save-btn">Generate</button>
                <button type="button" id="viewSheetsBtn" class="settings-save-btn sheet-view-btn">Manage Sheets</button>
            </div>
            <div id="practicingSummary" style="margin-top: 0.65rem; padding: 0.6rem 0.75rem; border-radius: 8px; background: #fff7df; color: #6b5500; font-size: 0.9rem;">
                Currently practicing: none
            </div>
            <div id="sheetErrorMessage" class="error hidden" style="margin-top: 0.8rem;"></div>
        </div>

        <div class="cards-section">
            <h2 class="cards-title">Chinese Character Writing Cards <span id="cardCount">(0)</span></h2>
            <div class="cards-toolbar">
                <select id="viewOrderSelect" class="sort-select">
                    <option value="added_time" selected>Order: Added Time (Recent to Oldest)</option>
                    <option value="queue">Order: Next Session Queue</option>
                    <option value="hardness_desc">Order: Hardness Score (Desc)</option>
                </select>
            </div>
            <div id="cardsGrid" class="cards-grid"></div>
        </div>
    </div>

    <script src="practice-manage-common.js"></script>
    <script src="kid-writing-manage.js"></script>
</body>
</html>
